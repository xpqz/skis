<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SKIS - Issue Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Highlight.js for syntax highlighting (bundled) -->
  <link rel="stylesheet" href="vendor/highlight-github.min.css">
  <script src="vendor/highlight.min.js"></script>
  <!-- Marked.js for Markdown parsing (bundled) -->
  <script src="vendor/marked.min.js"></script>
</head>
<body>
  <div class="app">
    <!-- Header with directory selector and filters -->
    <header class="header">
      <div class="header-left">
        <h1 class="logo">SKIS</h1>
        <div class="directory-selector">
          <input type="text" id="directory-path" placeholder="Select directory..." readonly>
          <button id="btn-browse" class="btn-secondary btn-small">Browse</button>
          <button id="btn-init" class="btn-secondary btn-small" title="Initialize SKIS" style="display: none;">Init</button>
        </div>
      </div>
      <div class="header-right">
        <div class="filters">
          <input type="search" id="search-input" placeholder="Search issues...">
          <select id="filter-state">
            <option value="open" selected>Open</option>
            <option value="closed">Closed</option>
          </select>
          <select id="filter-type">
            <option value="">All types</option>
            <option value="epic">Epic</option>
            <option value="task">Task</option>
            <option value="bug">Bug</option>
            <option value="request">Request</option>
          </select>
          <select id="filter-label">
            <option value="">All labels</option>
          </select>
        </div>
        <button id="btn-new-issue" class="btn-primary">+ New Issue</button>
      </div>
    </header>

    <!-- Main content area with split view -->
    <main class="main">
      <!-- Issue list panel (left) -->
      <aside class="issue-list-panel" id="issue-list-panel">
        <div class="list-header">
          <span class="issue-count" id="issue-count">0 issues</span>
          <div class="sort-controls">
            <select id="sort-by">
              <option value="updated">Updated</option>
              <option value="created">Created</option>
              <option value="id">ID</option>
            </select>
            <button id="btn-sort-order" class="btn-icon" title="Toggle sort order">↓</button>
          </div>
        </div>
        <div class="issue-list" id="issue-list">
          <!-- Issue items will be rendered here -->
          <div class="empty-state" id="empty-state">
            <p>No issues found</p>
          </div>
        </div>
      </aside>

      <!-- Draggable divider -->
      <div class="pane-divider" id="pane-divider"></div>

      <!-- Issue detail panel (right) -->
      <section class="issue-detail-panel" id="issue-detail-panel">
        <div class="detail-empty" id="detail-empty">
          <p>Select an issue to view details</p>
        </div>
        <div class="detail-content" id="detail-content" style="display: none;">
          <div class="detail-header">
            <span class="issue-id" id="detail-id">#1</span>
            <div class="detail-title-section">
              <h2 class="issue-title" id="detail-title">Issue Title</h2>
              <button class="btn-icon btn-edit-title" id="btn-edit-title" title="Edit title">✎</button>
              <div class="detail-title-edit" id="detail-title-edit" style="display: none;">
                <input type="text" id="title-edit-input" placeholder="Issue title...">
                <button class="btn-secondary btn-small" id="btn-title-cancel">Cancel</button>
                <button class="btn-primary btn-small" id="btn-title-save">Save</button>
              </div>
            </div>
            <div class="detail-actions">
              <button id="btn-edit" class="btn-link">edit</button>
              <button id="btn-close" class="btn-link">close</button>
              <button id="btn-reopen" class="btn-link" style="display: none;">reopen</button>
              <button id="btn-delete" class="btn-link btn-link-danger">delete</button>
            </div>
          </div>
          <div class="detail-labels-section">
            <div class="labels-header">
              <h3>Labels</h3>
              <button class="btn-icon btn-edit-labels" id="btn-edit-labels" title="Edit labels">✎</button>
            </div>
            <div class="detail-labels" id="detail-labels">
              <!-- Labels will be rendered here -->
            </div>
            <div class="labels-edit-form" id="labels-edit-form" style="display: none;">
              <div class="labels-dropdown-inline" id="labels-dropdown-inline">
                <div class="labels-menu-inline" id="labels-menu-inline">
                  <!-- Label checkboxes will be populated dynamically -->
                </div>
              </div>
              <div class="labels-edit-actions">
                <button class="btn-secondary btn-small" id="btn-labels-done">Done</button>
              </div>
            </div>
          </div>
          <div class="detail-body-section">
            <div class="detail-body-header">
              <span class="detail-body-label">Description</span>
              <button class="btn-icon btn-edit-body" id="btn-edit-body" title="Edit">✎</button>
            </div>
            <div class="detail-body markdown-body" id="detail-body">
              <!-- Issue body content -->
            </div>
            <div class="detail-body-edit" id="detail-body-edit" style="display: none;">
              <div class="body-edit-tabs">
                <button type="button" class="body-edit-tab active" id="body-edit-tab-edit">Edit</button>
                <button type="button" class="body-edit-tab" id="body-edit-tab-preview">Preview</button>
              </div>
              <textarea id="body-edit-input" placeholder="Describe the issue... (Markdown supported)"></textarea>
              <div id="body-edit-preview" class="body-edit-preview markdown-body"></div>
              <div class="body-edit-actions">
                <button class="btn-secondary" id="btn-body-cancel">Cancel</button>
                <button class="btn-primary" id="btn-body-save">Save</button>
              </div>
            </div>
          </div>
          <div class="detail-links" id="detail-links">
            <div class="links-header">
              <h3>Linked Issues</h3>
              <button class="btn-icon btn-new-link" id="btn-new-link" title="Link issue">+</button>
            </div>
            <div class="linked-issues" id="linked-issues">
              <!-- Linked issues will be rendered here -->
            </div>
            <div class="link-form" id="link-form" style="display: none;">
              <input type="number" id="link-issue-id" placeholder="Issue #" min="1">
              <button id="btn-link" class="btn-secondary btn-small">Link</button>
              <button id="btn-cancel-link" class="btn-secondary btn-small">Cancel</button>
            </div>
          </div>
          <div class="detail-comments" id="detail-comments">
            <div class="comments-header">
              <h3>Comments</h3>
              <button class="btn-icon btn-new-comment" id="btn-new-comment" title="Add comment">+</button>
            </div>
            <div class="comments-list" id="comments-list">
              <!-- Comments will be rendered here -->
            </div>
            <div class="comment-form" id="comment-form" style="display: none;">
              <textarea id="comment-input" placeholder="Add a comment... (Markdown supported)" rows="4"></textarea>
              <div class="comment-form-actions">
                <button id="btn-cancel-comment" class="btn-secondary">Cancel</button>
                <button id="btn-add-comment" class="btn-primary">Add Comment</button>
              </div>
            </div>
          </div>
        </div>
        <div class="detail-footer" id="detail-footer" style="display: none;">
          <span class="label-pill" id="detail-type">task</span>
          <span class="label-pill label-pill-state" id="detail-state">open</span>
          <span class="detail-timestamps" id="detail-timestamps">Created: now</span>
        </div>
      </section>
    </main>

  </div>

  <!-- Close issue dialog -->
  <div class="modal-overlay" id="close-modal-overlay" style="display: none;">
    <div class="modal modal-small" id="close-modal">
      <div class="modal-header">
        <h2>Close Issue</h2>
        <button class="btn-icon btn-close-modal">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="close-reason">Reason</label>
          <select id="close-reason">
            <option value="completed">Completed</option>
            <option value="not_planned">Not Planned</option>
          </select>
        </div>
        <div class="form-group">
          <label for="close-comment">Comment (optional)</label>
          <textarea id="close-comment" rows="3" placeholder="Add a closing comment..."></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary btn-close-modal">Cancel</button>
          <button type="button" id="btn-confirm-close" class="btn-primary">Close Issue</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="main.js"></script>
</body>
</html>
